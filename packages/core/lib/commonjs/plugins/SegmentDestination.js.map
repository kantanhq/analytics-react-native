{"version":3,"names":["_plugin","require","_types","_util","_api","_DestinationMetadataEnrichment","_QueueFlushingPlugin","_constants","_errors","MAX_EVENTS_PER_BATCH","MAX_PAYLOAD_SIZE_IN_KB","SEGMENT_DESTINATION_KEY","exports","SegmentDestination","DestinationPlugin","type","PluginType","destination","key","constructor","promise","resolve","createPromise","settingsPromise","settingsResolve","sendEvents","events","length","Promise","config","analytics","getConfig","defaultConfig","chunkedEvents","chunk","maxBatchSize","sentEvents","numFailedEvents","all","map","batch","res","uploadEvents","writeKey","url","getEndpoint","checkResponseForErrors","concat","e","reportInternalError","translateHTTPError","logger","warn","queuePlugin","dequeue","debug","info","error","QueueFlushingPlugin","proxy","apiHost","defaultApiHost","configure","undefined","add","DestinationMetadataEnrichment","update","settings","_type","segmentSettings","integrations","execute","event","enrichedEvent","flush"],"sourceRoot":"../../../src","sources":["plugins/SegmentDestination.ts"],"mappings":"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"}
