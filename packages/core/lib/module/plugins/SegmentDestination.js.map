{"version":3,"names":["DestinationPlugin","PluginType","chunk","createPromise","uploadEvents","DestinationMetadataEnrichment","QueueFlushingPlugin","defaultApiHost","checkResponseForErrors","translateHTTPError","defaultConfig","MAX_EVENTS_PER_BATCH","MAX_PAYLOAD_SIZE_IN_KB","SEGMENT_DESTINATION_KEY","SegmentDestination","type","destination","key","constructor","promise","resolve","settingsPromise","settingsResolve","sendEvents","events","length","Promise","config","analytics","getConfig","chunkedEvents","maxBatchSize","sentEvents","numFailedEvents","all","map","batch","res","writeKey","url","getEndpoint","concat","e","reportInternalError","logger","warn","queuePlugin","dequeue","debug","info","error","proxy","apiHost","configure","undefined","add","update","settings","_type","segmentSettings","integrations","execute","event","enrichedEvent","flush"],"sourceRoot":"../../../src","sources":["plugins/SegmentDestination.ts"],"mappings":"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"}
